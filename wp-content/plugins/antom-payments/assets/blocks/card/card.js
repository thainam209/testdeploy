(()=>{"use strict";var e={961:function(e,r,t){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},n.apply(this,arguments)},a=t(83),s=t(209),o=t(664),i=t(101),c=t(788),l={},d={VISA:"visa",MASTERCARD:"mastercard",AMERICAN_EXPRESS:"american-express",DINERS_CLUB:"diners-club",DISCOVER:"discover",JCB:"jcb",UNIONPAY:"unionpay",MAESTRO:"maestro",ELO:"elo",MIR:"mir",HIPER:"hiper",HIPERCARD:"hipercard"},m=[d.VISA,d.MASTERCARD,d.AMERICAN_EXPRESS,d.DINERS_CLUB,d.DISCOVER,d.JCB,d.UNIONPAY,d.MAESTRO,d.ELO,d.MIR,d.HIPER,d.HIPERCARD],p=(0,c.clone)(m);function u(e){return l[e]||a[e]}function g(e,r){void 0===r&&(r=!1);var t=p.indexOf(e);if(!r&&-1===t)throw new Error('"'+e+'" is not a supported card type.');return t}function h(e){var r=[];if(!(0,o.isValidInputType)(e))return r;if(0===e.length)return p.map((function(e){return(0,c.clone)(u(e))}));p.forEach((function(t){var n=u(t);(0,s.addMatchingCardsToResults)(e,n,r)}));var t=(0,i.findBestMatch)(r);return t?[t]:r}h.getTypeInfo=function(e){return(0,c.clone)(u(e))},h.removeCard=function(e){var r=g(e);p.splice(r,1)},h.addCard=function(e){var r=g(e.type,!0);l[e.type]=e,-1===r&&p.push(e.type)},h.updateCard=function(e,r){var t=l[e]||a[e];if(!t)throw new Error('"'.concat(e,"\" is not a recognized type. Use `addCard` instead.'"));if(r.type&&t.type!==r.type)throw new Error("Cannot overwrite type parameter.");var s=(0,c.clone)(t);s=n(n({},s),r),l[s.type]=s},h.changeOrder=function(e,r){var t=g(e);p.splice(t,1),p.splice(r,0,e)},h.resetModifications=function(){p=(0,c.clone)(m),l={}},h.types=d,e.exports=h},209:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.addMatchingCardsToResults=void 0;var n=t(788),a=t(256);r.addMatchingCardsToResults=function(e,r,t){var s,o;for(s=0;s<r.patterns.length;s++){var i=r.patterns[s];if((0,a.matches)(e,i)){var c=(0,n.clone)(r);o=Array.isArray(i)?String(i[0]).length:String(i).length,e.length>=o&&(c.matchStrength=o),t.push(c);break}}}},83:e=>{e.exports={visa:{niceType:"Visa",type:"visa",patterns:[4],gaps:[4,8,12],lengths:[16,18,19],code:{name:"CVV",size:3}},mastercard:{niceType:"Mastercard",type:"mastercard",patterns:[[51,55],[2221,2229],[223,229],[23,26],[270,271],2720],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},"american-express":{niceType:"American Express",type:"american-express",patterns:[34,37],gaps:[4,10],lengths:[15],code:{name:"CID",size:4}},"diners-club":{niceType:"Diners Club",type:"diners-club",patterns:[[300,305],36,38,39],gaps:[4,10],lengths:[14,16,19],code:{name:"CVV",size:3}},discover:{niceType:"Discover",type:"discover",patterns:[6011,[644,649],65],gaps:[4,8,12],lengths:[16,19],code:{name:"CID",size:3}},jcb:{niceType:"JCB",type:"jcb",patterns:[2131,1800,[3528,3589]],gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVV",size:3}},unionpay:{niceType:"UnionPay",type:"unionpay",patterns:[620,[62100,62182],[62184,62187],[62185,62197],[62200,62205],[622010,622999],622018,[62207,62209],[623,626],6270,6272,6276,[627700,627779],[627781,627799],[6282,6289],6291,6292,810,[8110,8131],[8132,8151],[8152,8163],[8164,8171]],gaps:[4,8,12],lengths:[14,15,16,17,18,19],code:{name:"CVN",size:3}},maestro:{niceType:"Maestro",type:"maestro",patterns:[493698,[5e5,504174],[504176,506698],[506779,508999],[56,59],63,67,6],gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],code:{name:"CVC",size:3}},elo:{niceType:"Elo",type:"elo",patterns:[401178,401179,438935,457631,457632,431274,451416,457393,504175,[506699,506778],[509e3,509999],627780,636297,636368,[650031,650033],[650035,650051],[650405,650439],[650485,650538],[650541,650598],[650700,650718],[650720,650727],[650901,650978],[651652,651679],[655e3,655019],[655021,655058]],gaps:[4,8,12],lengths:[16],code:{name:"CVE",size:3}},mir:{niceType:"Mir",type:"mir",patterns:[[2200,2204]],gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVP2",size:3}},hiper:{niceType:"Hiper",type:"hiper",patterns:[637095,63737423,63743358,637568,637599,637609,637612],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},hipercard:{niceType:"Hipercard",type:"hipercard",patterns:[606282],gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}}}},788:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.clone=function(e){return e?JSON.parse(JSON.stringify(e)):null}},101:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.findBestMatch=void 0,r.findBestMatch=function(e){return function(e){var r=e.filter((function(e){return e.matchStrength})).length;return r>0&&r===e.length}(e)?e.reduce((function(e,r){return e?Number(e.matchStrength)<Number(r.matchStrength)?r:e:r})):null}},664:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isValidInputType=void 0,r.isValidInputType=function(e){return"string"==typeof e||e instanceof String}},256:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.matches=void 0,r.matches=function(e,r){return Array.isArray(r)?function(e,r,t){var n=String(r).length,a=e.substr(0,n),s=parseInt(a,10);return r=parseInt(String(r).substr(0,a.length),10),t=parseInt(String(t).substr(0,a.length),10),s>=r&&s<=t}(e,r[0],r[1]):function(e,r){return(r=String(r)).substring(0,e.length)===e.substring(0,r.length)}(e,r)}},20:(e,r,t)=>{var n=t(609),a=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,r,t){var n,c={},l=null,d=null;for(n in void 0!==t&&(l=""+t),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(d=r.ref),r)s.call(r,n)&&!i.hasOwnProperty(n)&&(c[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===c[n]&&(c[n]=r[n]);return{$$typeof:a,type:e,key:l,ref:d,props:c,_owner:o.current}}r.jsx=c,r.jsxs=c},848:(e,r,t)=>{e.exports=t(20)},609:e=>{e.exports=window.React}},r={};function t(n){var a=r[n];if(void 0!==a)return a.exports;var s=r[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}t.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},t.d=(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);const n=window.wp.i18n,a=window.wc.wcBlocksRegistry,s=window.wp.htmlEntities,o=window.wc.wcSettings;var i=t(609),c=t(961),l=t.n(c);const d=window.jQuery;var m=t.n(d),p=t(848);const u=e=>{var r="";const{eventRegistration:t,emitResponse:n,settings:a}=e,{onCheckoutValidationBeforeProcessing:s,onPaymentSetup:o,onCheckoutAfterProcessingWithSuccess:c,onCheckoutAfterProcessingWithError:d}=t,[u,g]=(0,i.useState)(""),[h,y]=(0,i.useState)(""),[_,f]=(0,i.useState)(""),[v,x]=(0,i.useState)(""),[C,S]=(0,i.useState)(!1),[E,N]=(0,i.useState)(""),[b,M]=(0,i.useState)(""),j=(0,i.useRef)(null),w=(0,i.useRef)(null),R=(0,i.useRef)(null),T=(0,i.useRef)(null),I=e=>{let r=e.target.value;if(r=r.replace(/\D/g,""),r.length>19&&(r=r.slice(0,19)),r.length>12){const e=l()(r);if(e.length>0){let r="Unknown";void 0!==e[0].niceType&&(r=e[0].niceType),y(e[0].niceType)}else y("")}0===r.length&&y(""),r=r.replace(/(.{4})/g,"$1 ").trim(),g(r),setTimeout((()=>{j.current.focus()}),0)},O=e=>{x(_);let r=e.target.value;if(r=r.replace(/\D/g,""),r=r.substring(0,4),1===r.length&&parseInt(r)>=2&&(r="0"+r),r.length>2&&(r=r.substring(0,2)+"/"+r.substring(2)),r.length>=2){const e=parseInt(r.substring(0,2));e>12&&(r="12"+r.substring(2)),0===e&&(r="01"+r.substring(2))}f(r),setTimeout((()=>{w.current.focus()}),0)};(0,i.useEffect)((()=>{_.length<v.length?S(!0):S(!1)}),[_,v]);const P=e=>{let r=e.target.value;r=r.replace(/\D/g,""),r=r.substring(0,4),N(r),setTimeout((()=>{R.current.focus()}),0)},D=e=>{let r=e.target.value;M(r),setTimeout((()=>{T.current.focus()}),0)};(0,i.useEffect)((()=>{const e=(e,r)=>{const t=document.getElementsByClassName(e);if(t.length>0){const e=t[0];e.textContent=r,e.style.display="block"}else console.warn(`Element with class "${e}" not found.`)};function t(e){const r=document.getElementsByClassName(e);for(let e=0;e<r.length;e++)r[e].style.display="none",r[e].textContent="";0===r.length&&console.warn(`Element with class "${e}" not found.`)}const n=e=>e.replace(/^\s+|\s+$/g,""),o=()=>{var e=new Date,r=e.getFullYear(),t=e.getMonth()+1,n=e.getDate(),a=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),a<10&&(a="0"+a),s<10&&(s="0"+s),o<10&&(o="0"+o),r+"-"+t+"-"+n+" "+a+":"+s+":"+o};s((s=>{if((()=>{let e="radio-control-wc-payment-method-options-"+a.payment_method;return m()("#"+e).is(":checked")})()){const s=document.querySelector("input.antom-card-number");let l="";if(s&&(l=s.value),!l)return e("antom-card-number-error",a.card_validate_message.card_empty_error_message),{type:"error",errorMessage:a.card_validate_message.card_empty_error_message};if(!(e=>(e=e.replace(/\D/g,""),/^\d{14,19}$/.test(e)))(l))return e("antom-card-number-error",a.card_validate_message.card_invalid_error_message),{type:"error",errorMessage:a.card_validate_message.card_invalid_error_message};t("antom-card-number-error");const d=document.querySelector("input.antom-expire-date");let p="";if(d&&(p=d.value),!p)return e("antom-expire-date-error",a.card_validate_message.expiry_empty_error_message),{type:"error",errorMessage:a.card_validate_message.expiry_empty_error_message};if(!(e=>{if(!/^(\d{2}\/\d{2}|\d{2} \/ \d{2})$/.test(e))return!1;const r=e.split("/"),t=parseInt(r[0],10),n=parseInt(r[1],10);return!(n<(new Date).getFullYear()%100||t<1||t>12||new Date(n+2e3,t,0)<new Date)})(p))return e("antom-expire-date-error",a.card_validate_message.expire_invalid_error_message),{type:"error",errorMessage:a.card_validate_message.expire_invalid_error_message};t("antom-expire-date-error");const u=document.querySelector("input.antom-cvc");let g="";if(u&&(g=u.value),!g)return e("antom-cvc-error",a.card_validate_message.cvv_empty_error_message),{type:"error",errorMessage:a.card_validate_message.cvv_empty_error_message};if(!/^\d{3}$/.test(g))return e("antom-cvc-error",a.card_validate_message.cvv_invalid_error_message),{type:"error",errorMessage:a.card_validate_message.cvv_invalid_error_message};t("antom-cvc-error");const h=document.querySelector("input.antom-holder-name");let y="";if(h&&(y=h.value),!y)return e("antom-holder-name-error",a.card_validate_message.holder_name_required),{type:"error",errorMessage:a.card_validate_message.holder_name_required};t("antom-holder-name-error");let _=p.split("/"),f=n(_[0]),v=n(_[1]);const x=(()=>{let e="";for(let r=0;r<31;r++)e+="1234567890"[Math.floor(10*Math.random())];return e=Math.floor(9*Math.random()+1)+e,e})(),C=((e,r,t,n,a="")=>{let s="",o="",i=(a=a.trim()).indexOf(" ");-1!==i?(s=a.substring(0,i),o=a.slice(i).trim()):s=a,a.indexOf()&&(r=r.replace(/\s/g,""));let c={paymentMethodDetail:{paymentMethodDetailType:"card",card:{cardNo:r,expiryMonth:t,expiryYear:n},instUserName:{firstName:s,fullName:a,lastName:o,middleName:""}}};return CryptoJS.AES.encrypt(JSON.stringify(c),e,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()})(CryptoJS.enc.Utf8.parse(x),l,f,v,y),S=new JSEncrypt,E="-----BEGIN PUBLIC KEY-----\n    "+a.card_public_key.replace(/\s/g,"")+"    -----END PUBLIC KEY-----";S.setPublicKey(E);let N=S.encrypt(x);a.card_token_url;const b={"client-id":a.client_id,"request-time":o(),signature:"algorithm=RSA256, keyVersion=2, signature=testing_signature",encrypt:"algorithm=AES256, keyVersion=0, symmetricKey="+encodeURIComponent(N)};var i=!1,c=!1;if(m().ajax({type:"POST",url:a.card_token_url,data:C,contentType:"text/plain",headers:b,async:!1,success:function(e){return e&&e.paymentMethodDetail&&e.paymentMethodDetail.card&&e.paymentMethodDetail.card.cardToken?(i=!0,r=e.paymentMethodDetail.card.cardToken,{type:"success"}):e&&e.result&&"KEY_NOT_FOUND"==e.result.resultCode?(c=!0,console.log("key not found"),{type:"error",errorMessage:"clientId error, Please use an account register from antom plugin to process card payment"}):{type:"error",errorMessage:a.antom_card_token_fetch_error}},error:function(e,r,t){return{type:"error",errorMessage:a.antom_card_token_fetch_error}}}),!1===i)return console.log("afterprocess"),!0===c?{type:"error",errorMessage:"clientId error, Please use an account register from antom plugin to process card payment"}:{type:"error",errorMessage:a.antom_card_token_fetch_error}}}))}),[n.responseTypes.ERROR,n.responseTypes.SUCCESS,s]),(0,i.useEffect)((()=>{const e=o((()=>r.length?{type:n.responseTypes.SUCCESS,meta:{paymentMethodData:{antom_card_token:r}}}:{type:n.responseTypes.ERROR,message:"There was an error"}));return()=>{e()}}),[o]),(0,i.useEffect)((()=>{const e=c((()=>{}));return()=>{e()}}),[c]),(0,i.useEffect)((()=>{const e=d((()=>{isAntomCardChecked()}));return()=>{e()}}),[d]);const k=h?a.card_icon_lists[h]:a.card_icon_lists.card,A=a.is_test_mode,V=(a.is_logged_in,a.login_warning_message,()=>(0,p.jsxs)("div",{className:"antom-cards",children:[(0,p.jsx)("div",{className:"antom-cards-container",children:(0,p.jsx)("p",{children:"Card Information"})}),(0,p.jsx)("div",{className:"antom-cards-container",children:(0,p.jsxs)("div",{className:"antom-cards-container-item",children:[(0,p.jsxs)("div",{className:"antom-cards-container-item-line",children:[(0,p.jsx)("div",{className:"card-cover",children:k&&(0,p.jsx)("img",{src:k,alt:`${h} icon`})}),(0,p.jsx)("input",{placeholder:"Card number",id:"antom-card-number",className:"antom-card-number",value:u,onChange:I,ref:j})]}),(0,p.jsx)("div",{className:"antom-cards-container-item-line antom-cards-container-item-error antom-card-number-error"})]})}),(0,p.jsxs)("div",{className:"antom-cards-container",children:[(0,p.jsxs)("div",{className:"antom-cards-container-item expire-date",children:[(0,p.jsx)("div",{className:"antom-cards-container-item-line",children:(0,p.jsx)("input",{placeholder:"Exipre date",id:"antom-expire-date",className:"antom-expire-date",value:_,onChange:O,ref:w})}),(0,p.jsx)("div",{className:"antom-cards-container-item-line antom-cards-container-item-error antom-expire-date-error"})]}),(0,p.jsxs)("div",{className:"antom-cards-container-item",children:[(0,p.jsx)("div",{className:"antom-cards-container-item-line",children:(0,p.jsx)("input",{placeholder:"CVC",id:"antom-cvc",className:"antom-cvc",value:E,onChange:P,ref:R})}),(0,p.jsx)("div",{className:"antom-cards-container-item-line antom-cards-container-item-error antom-cvc-error"})]})]}),(0,p.jsx)("div",{className:"antom-cards-container",children:(0,p.jsxs)("div",{className:"antom-cards-container-item",children:[(0,p.jsx)("div",{className:"antom-cards-container-item-line",children:(0,p.jsx)("input",{placeholder:"Holder name",id:"antom-holder-name",className:"antom-holder-name",value:b,onChange:D,ref:T})}),(0,p.jsx)("div",{className:"antom-cards-container-item-line antom-cards-container-item-error antom-holder-name-error"})]})}),A&&(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"antom-test-mode-warning",children:"run in antom test mode"}),(0,p.jsxs)("p",{className:"antom-test-mode-info",children:["you can test with this card number : ",(0,p.jsx)("span",{className:"strong",children:"4054695723100768"})," . expire date with this format : ",(0,p.jsx)("span",{className:"strong",children:" MM / YY"})," , such as ",(0,p.jsx)("span",{className:"strong",children:"02 / 29"}),", CVC with any Three digits, such as ",(0,p.jsx)("span",{className:"strong",children:"123"})]})]})]}));return(0,p.jsx)("div",{children:(0,p.jsx)(V,{})})},g=window.wp.blockEditor,h=e=>{const{label:r,onChange:t}=e;return(0,p.jsx)(g.RichText,{tagName:"label",value:r,onChange:t,...(0,g.useBlockProps)()})},y=(0,o.getSetting)("antom_card_data",{}),_=(0,n.__)("V/M Card","antom-payments");let f='<span class="wc-block-components-payment-method-label" style="display:flex;flex-direction:row;align-items:center">';f+=(0,s.decodeEntities)(y.title)||_,Array.isArray(y.icon)&&y.icon.length>0&&(f+='<span class="antom-payment-block-icons antom-payment-icons">',y.icon.forEach((e=>{f+='<img class="antom-payment-icons-item" src="'+e+'"/>'})),f+="</span>"),f+="</span>";const v={name:"antom_card",label:(0,p.jsx)(h,{label:f}),content:(0,p.jsx)(u,{settings:y}),edit:(0,p.jsx)(u,{settings:y}),canMakePayment:()=>!0,ariaLabel:f,paymentMethodId:"antom_card",supports:{features:y.supports}};(0,a.registerPaymentMethod)(v)})();