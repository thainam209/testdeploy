function get_card_icon_by_type(e){var t={"":"card-gray.svg",Unknown:"card-highlight.svg",Visa:"VISA.svg",Mastercard:"MasterCard.svg"};return void 0===t[e]?"card.svg":t[e]}function format_card_number(e){var t=jQuery,r=(r=t(e).val().replace(/\D/g,"")).substring(0,16);let a;a=""==r?get_card_icon_by_type(""):get_card_icon_by_type(get_card_type(r));var n=t(".antom-cards-container-item-line > .card-cover").find("img"),o=n.data("host");n.attr("src",o+a),r=r.replace(/(\d{4})(?=\d)/g,"$1 "),t(e).val(r)}function get_card_type(e){return/^4[0-9]{12}(?:[0-9]{3})?$/.test(e)?"Visa":/^5[1-5][0-9]{14}$/.test(e)?"Mastercard":"Unknown"}function format_expire_date(e,t){var r,a=jQuery;let n=a(e).val();2<=(n=2<(n=1===(n=(n=n.replace(/\D/g,"")).substring(0,4)).length&&2<=parseInt(n)?"0"+n:n).length?n.substring(0,2)+"/"+n.substring(2):n).length&&(12<(r=parseInt(n.substring(0,2)))&&(n="12"+n.substring(2)),0===r)&&(n="01"+n.substring(2)),a(e).val(n)}function format_cvc(e){var t=jQuery;let r=t(e).val();r=(r=r.replace(/\D/g,"")).substring(0,4),t(e).val(r.slice(0,4))}!function(s){function m(e,t="",r=!1){s(".woocommerce-notices-wrapper").first().html('<div class="woocommerce-error antom-errors">'+e+"</div>"),t&&s("."+t).html(e).removeClass("hide-error"),r&&s("html, body").animate({scrollTop:0},500)}function d(e=""){s(".antom-errors").remove(),e&&s("."+e).addClass("hide-error")}function _(e){return e.replace(/^\s+|\s+$/g,"")}function u(){l(antom_payment_gateways_settings.request_to_antom_payments_gateway),s.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:s("form.checkout").serialize(),dataType:"json",beforeSend:function(){s("body").trigger("update_checkout")},success:function(t){try{"success"===t.result?(l(antom_payment_gateways_settings.redirect_to_antom_loading_description),antom_payment_gateways_settings.antom_is_mobile?(window.location.href=t.redirect_app_url,setTimeout(function(){document.hidden||document.webkitHidden?s("body").trigger("update_checkout"):window.location.href=t.redirect},3e3)):window.location.href=t.redirect):(g(),m(r(t.messages),"",!0))}catch(e){!0===t.reload?window.location.reload():(!0===t.refresh&&s(document.body).trigger("update_checkout"),g(),t.messages?m(r(t.messages),"",!0):m(wc_checkout_params.i18n_checkout_error))}},error:function(e,t,r){wc_checkout_form.detachUnloadEventsOnSubmit();"object"==typeof wc_checkout_params&&null!==wc_checkout_params&&wc_checkout_params.hasOwnProperty("i18n_checkout_error")&&"string"==typeof wc_checkout_params.i18n_checkout_error&&""!==wc_checkout_params.i18n_checkout_error.trim()&&(r=wc_checkout_params.i18n_checkout_error),wc_checkout_form.submit_error('<div class="woocommerce-error">'+r+"</div>")}})}function r(e){return e.replace(/<\/?[^>]+(>|$)/g,"")}function l(e=""){s("body").css("overflow","hidden"),e&&s("#antom-loading-mask").find("p").text(e),s("#antom-loading-mask").show()}function g(){s("body").css("overflow","auto"),s("#antom-loading-mask").hide()}s(document).ready(function(){0===s("#antom-loading-mask").length&&s("body").append('<div id="antom-loading-mask"><img style="width:30px;" src="'+antom_payment_gateways_settings.redirect_to_antom_loading_image_url+'" alt="Loading..."><p></p></div>'),s("body").on("change",'input[name="payment_method"]',function(){var e=s(this).val(),t=s(".antom-test-mode-warning");e.startsWith("antom_")?(is_antom_payment_gateway=!0,t.show()):t.hide()}),s(document).on("click","form.checkout #place_order",function(e){var t,r,a,n,o,c=s('input[name="payment_method"]:checked').val();let i=!1;(i=c.startsWith("antom_")?!0:i)&&(e.preventDefault(),"antom_card"==c?(e=s(".antom-cards-container-item"),c=e.find(".antom-card-number").val(),n=e.find(".antom-expire-date").val(),t=e.find(".antom-cvc").val(),e=e.find(".antom-holder-name").val(),c?(o=(o=c).replace(/\D/g,""),/^4[0-9]{12}(?:[0-9]{3})?$/.test(o)||/^5[1-5][0-9]{14}$/.test(o)?(d("antom-card-number-error"),n?!function(e){var t;if(/^(\d{2}\/\d{2}|\d{2} \/ \d{2})$/.test(e))return e=e.split("/"),t=parseInt(e[0],10),!((e=parseInt(e[1],10))<(new Date).getFullYear()%100||t<1||12<t||new Date(e+2e3,t,0)<new Date)}(n)?m(antom_languages.expire_invalid_error_message,"antom-expire-date-error"):(d("antom-expire-date-error"),t?/^\d{3}$/.test(t)?(d("antom-cvc-error"),""==e?m(antom_languages.holder_name_required,"antom-holder-name-error"):(d("antom-holder-name-error"),t=_((o=n.split("/"))[0]),n=_(o[1]),d(),o=function(){var t="1234567890";let r="";for(let e=0;e<31;e++){var a=Math.floor(Math.random()*t.length);r+=t[a]}return r=Math.floor(9*Math.random()+1)+r}(),c=function(e,t,r,a,n=""){let o="",c="";-1!==(i=(n=n.trim()).indexOf(" "))?(o=n.substring(0,i),c=n.slice(i).trim()):o=n;var i={paymentMethodDetail:{paymentMethodDetailType:"card",card:{cardNo:t=n.indexOf()?t.replace(/\s/g,""):t,expiryMonth:r,expiryYear:a},instUserName:{firstName:o,fullName:n,lastName:c,middleName:""}}};return CryptoJS.AES.encrypt(JSON.stringify(i),e,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()}(CryptoJS.enc.Utf8.parse(o),c,t,n,e),t=new JSEncrypt,n="-----BEGIN PUBLIC KEY-----\n    "+antom_card_settings.antom_public_key.replace(/\s/g,"")+"    -----END PUBLIC KEY-----",t.setPublicKey(n),e=t.encrypt(o),l(antom_payment_gateways_settings.request_to_antom_payments_gateway),s.ajax({type:"POST",url:antom_card_settings.card_token_url,data:c,contentType:"text/plain",headers:{"client-id":antom_card_settings.client_id,"request-time":(t=(n=new Date).getFullYear(),o=n.getMonth()+1,c=n.getDate(),r=n.getHours(),a=n.getMinutes(),n=n.getSeconds(),t+"-"+(o=o<10?"0"+o:o)+"-"+(c=c<10?"0"+c:c)+" "+(r=r<10?"0"+r:r)+":"+(a=a<10?"0"+a:a)+":"+(n=n<10?"0"+n:n)),signature:"algorithm=RSA256, keyVersion=2, signature=testing_signature",encrypt:"algorithm=AES256, keyVersion=0, symmetricKey="+encodeURIComponent(e)},success:function(e){var t;void 0!==e.paymentMethodDetail&&void 0!==e.paymentMethodDetail.card&&void 0!==e.paymentMethodDetail.card.cardToken?(t=e.paymentMethodDetail.card.cardToken,s("#antom_card_token").val(t),u()):void 0!==e.result&&void 0!==e.result.resultMessage?(g(),m(antom_languages.antom_card_token_fetch_error)):(g(),m(wc_checkout_params.i18n_checkout_error))},error:function(e,t,r){g(),m(wc_checkout_params.i18n_checkout_error)}}))):m(antom_languages.cvv_invalid_error_message,"antom-cvc-error"):m(antom_languages.cvv_empty_error_message,"antom-cvc-error")):m(antom_languages.expiry_empty_error_message,"antom-expire-date-error")):m(antom_languages.card_invalid_error_message,"antom-card-number-error")):m(antom_languages.card_empty_error_message,"antom-card-number-error")):u())})})}(jQuery);